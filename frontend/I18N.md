# Angular i18n Configuration

This document describes the internationalization (i18n) setup for the MotsPassants library application.

## Overview

The application uses Angular's built-in i18n framework to support multiple languages. Currently supported languages:

- **English (en-US)** - Default/source language
- **French (fr)** - French translation

## Architecture

### i18n Configuration

The i18n configuration is defined in `angular.json`:

```json
{
  "i18n": {
    "sourceLocale": "en-US",
    "locales": {
      "fr": {
        "translation": "src/locale/messages.fr.xlf",
        "baseHref": ""
      }
    }
  }
}
```

### Translation Files

Translation files are stored in `src/locale/`:

- `messages.xlf` - Source file (English) containing all translatable strings
- `messages.fr.xlf` - French translations

The translation files use the XLIFF 2.0 format, which is an industry-standard format for localization.

## Development Workflow

### Adding New Translatable Strings

1. **Mark strings for translation** in component templates using the `i18n` attribute:

```html
<!-- Simple text -->
<h1 i18n="Page title|Settings page title@@settingsTitle">Settings</h1>

<!-- With description and ID -->
<span i18n="Navigation link|All books link@@navAllBooks">All Books</span>

<!-- For attributes -->
<button i18n-aria-label="Refresh button|Refresh health@@settingsRefreshHealthAria" 
        aria-label="Refresh health">
  Refresh
</button>
```

The i18n attribute format is: `meaning|description@@id`
- **meaning**: Context where the string is used
- **description**: More detailed description
- **id**: Unique identifier (optional but recommended)

2. **Extract translatable strings** to generate/update the source translation file:

```bash
npm run ng extract-i18n
```

This creates/updates `src/locale/messages.xlf`

3. **Translate strings** in `messages.fr.xlf`:

```xml
<unit id="settingsTitle">
  <segment>
    <source>Settings</source>
    <target>Paramètres</target>
  </segment>
</unit>
```

4. **Build and test** with the new translations:

```bash
npm run build
```

## Building for Production

### Build All Locales

The default build creates separate bundles for all configured locales:

```bash
npm run build
```

Output structure:
```
dist/frontend/browser/
├── en-US/          # English bundle
│   ├── index.html
│   └── ...
└── fr/             # French bundle
    ├── index.html
    └── ...
```

### Build Specific Locale

To build only a specific locale:

```bash
# English only
ng build --localize=false

# Specific locale
ng build --configuration=production,fr
```

## Language Switching

### User Interface

Users can switch languages through the **Language Preferences** card in the Settings page. The language preference is stored in `localStorage` and persists across sessions.

### Implementation

The `LanguageService` (`src/app/services/language.service.ts`) handles language switching:

```typescript
export class LanguageService {
  switchLanguage(localeCode: string): void {
    // Store preference
    localStorage.setItem('preferredLocale', localeCode);
    
    // Navigate to the new locale URL
    window.location.href = `/${localeCode}${currentPath}`;
  }
}
```

### URL Structure

Each locale has its own URL path:
- English (default): `/` or `/en-US/`
- French: `/fr/`

## Adding a New Language

1. **Update `angular.json`** to add the new locale:

```json
{
  "i18n": {
    "locales": {
      "fr": { ... },
      "es": {
        "translation": "src/locale/messages.es.xlf",
        "baseHref": ""
      }
    }
  }
}
```

2. **Create translation file**:

```bash
# Copy the source file
cp src/locale/messages.xlf src/locale/messages.es.xlf

# Update the trgLang attribute
# Edit messages.es.xlf and change:
# <xliff ... trgLang="es">

# Translate all <target> elements
```

3. **Update `LanguageService`** (`src/app/services/language.service.ts`):

```typescript
readonly availableLanguages: Language[] = [
  { code: 'en-US', name: 'English', nativeName: 'English' },
  { code: 'fr', name: 'French', nativeName: 'Français' },
  { code: 'es', name: 'Spanish', nativeName: 'Español' }  // Add new language
];
```

4. **Build and test**:

```bash
npm run build
```

## Best Practices

1. **Use meaningful IDs**: Always provide custom IDs for i18n strings to prevent them from changing when the text changes
2. **Add context**: Use the meaning and description fields to help translators understand the context
3. **Keep strings simple**: Avoid complex HTML in translatable strings when possible
4. **Test both locales**: Always test the application in all supported languages
5. **Handle plurals**: Use ICU message syntax for plurals and select statements:
   ```html
   <span i18n>{count, plural, =0 {no books} =1 {one book} other {{{count}} books}}</span>
   ```

## Troubleshooting

### Missing translations

If a translation is missing, Angular will fall back to the source text. Check:
1. The string has been extracted with `ng extract-i18n`
2. The translation exists in the target locale file
3. The build includes the locale

### Build errors

If you encounter build errors:
1. Validate XLIFF files are well-formed XML
2. Ensure all `<ph>` (placeholder) elements are preserved in translations
3. Check that locale codes match between `angular.json` and translation files

### Language not switching

If language switching doesn't work:
1. Check browser console for navigation errors
2. Verify the locale build exists in `dist/frontend/browser/`
3. Ensure the server is configured to serve locale-specific paths

## Resources

- [Angular i18n Guide](https://angular.dev/guide/i18n)
- [XLIFF 2.0 Specification](http://docs.oasis-open.org/xliff/xliff-core/v2.0/xliff-core-v2.0.html)
- [ICU Message Format](https://unicode-org.github.io/icu/userguide/format_parse/messages/)
